# Сервис записи текста в метаданные.

Сервис записи текста в метаданные — это веб-приложение на Python, построенное с использованием Flask, которое позволяет пользователям загружать изображения, автоматически обрабатывать их (с использованием OCR, детекции объектов, проверки орфографии и перевода) и получать подробные результаты в виде HTML-страниц, XML-файлов и статистических отчётов в Excel. Приложение также поддерживает голосовое озвучивание результатов прямо в браузере и предоставляет Swagger-документацию для API.

---

## Функциональность

- **Загрузка и обработка изображений:**
  - Множественная загрузка изображений.
  - Распознавание текста с помощью Tesseract (через pytesseract).
  - Детекция объектов.
  - Коррекция орфографии и перевод текста (на русский язык).
  - Генерация XML-метаданных для каждого изображения.

- **История и результаты:**
  - Просмотр истории обработанных изображений.
  - Детальная страница результата с возможностью скачивания исходного изображения и XML-файла.
  - Голосовое озвучивание результатов.

- **Поиск:**
  - Поиск по ключевым словам в результатах обработки.

- **Статистика:**
  - Вычисление наиболее часто встречающихся слов, объектов и файлов с наибольшим количеством исправлений.
  - Отображение интерактивных графиков (Chart.js) на странице статистики.
  - Экспорт статистики в красиво оформленный Excel-файл с диаграммами (с использованием openpyxl и Matplotlib).

- **Документация API:**
  - Автоматическая Swagger документация (через Flasgger) доступная по адресу `/apidocs`.

---

## Технологический стек

- **Backend:** Python 3.12, Flask  
- **Frontend:** HTML, CSS, JavaScript, Chart.js  
- **OCR и обработка изображений:** Tesseract OCR, Pytesseract, Pillow  
- **Статистика и отчётность:** Collections, Matplotlib, openpyxl  
- **Документация API:** Flasgger (Swagger UI)  
- **Голосовое озвучивание:** Web Speech API

---

## Зависимости

Установите зависимости с помощью файла `requirements.txt`:

```bash
pip install -r requirements.txt
```

## Содержимое requirements.txt
```txt
anyio==4.8.0
attrs==25.3.0
blinker==1.9.0
certifi==2025.1.31
charset-normalizer==3.4.1
click==8.1.8
colorama==0.4.6
contourpy==1.3.1
cycler==0.12.1
et_xmlfile==2.0.0
filelock==3.18.0
flasgger==0.9.7.1
Flask==3.1.0
fonttools==4.56.0
fsspec==2025.3.0
googletrans==4.0.2
h11==0.14.0
h2==4.2.0
hpack==4.1.0
httpcore==1.0.7
httpx==0.28.1
hyperframe==6.1.0
idna==3.10
itsdangerous==2.2.0
Jinja2==3.1.6
jsonschema==4.23.0
jsonschema-specifications==2024.10.1
kiwisolver==1.4.8
MarkupSafe==3.0.2
matplotlib==3.10.1
mistune==3.1.2
mpmath==1.3.0
networkx==3.4.2
numpy==2.1.1
opencv-python==4.11.0.86
openpyxl==3.1.5
packaging==24.2
pandas==2.2.3
piexif==1.1.3
pillow==11.1.0
psutil==7.0.0
py-cpuinfo==9.0.0
pyparsing==3.2.1
pytesseract==0.3.13
python-dateutil==2.9.0.post0
pytz==2025.1
PyYAML==6.0.2
referencing==0.36.2
requests==2.32.3
rpds-py==0.23.1
scipy==1.15.2
seaborn==0.13.2
setuptools==76.0.0
six==1.17.0
sniffio==1.3.1
sympy==1.13.1
torch==2.6.0
torchvision==0.21.0
tqdm==4.67.1
typing_extensions==4.12.2
tzdata==2025.1
ultralytics==8.3.90
ultralytics-thop==2.0.14
urllib3==2.3.0
Werkzeug==3.1.3
```
***Установка и запуск***

***Клонирование репозитория***
```bash
git clone https://github.com/TarasPinchuk/LegacyDetector.git
cd LegacyDetector
```

***Создание и активация виртуального окружения (опционально)***
Linux:
```bash
python -m venv venv
source venv/bin/activate 
```

Windows:
```bash
python -m venv venv
./venv/bin/activate 
```

***Установка зависимостей***
```bash
pip install -r requirements.txt
```

***Установка Tesseract OCR***

***Ubuntu/Debian:***
```bash
sudo apt-get install tesseract-ocr
```

***Windows:***
```bash
Скачайте установщик с [Tesserac-OCR-GitHub](https://github.com/tesseract-ocr/tesseract/releases) или UB Mannheim Tesseract и установите его.
Добавьте путь к Tesseract в переменную среды PATH или настройте pytesseract.pytesseract.tesseract_cmd в коде.
```

***Запуск приложения***
```bash
python app.py
```

Приложение будет доступно по адресу: [http://127.0.0.1:5000/](http://127.0.0.1:5000/)

***Документация API***
Перейдите на: [http://127.0.0.1:5000/apidocs](http://127.0.0.1:5000/apidocs) для просмотра Swagger UI.

***Структура проекта***
```
LegacyDetector/
├── templates/               # HTML-шаблоны
│   ├── index.html           # Главная страница
│   ├── search.html          # Страница поиска
│   ├── result.html          # Детальная страница результата
│   ├── results.html         # Страница с результатами обработки
│   └── stats.html           # Страница статистики
├── static/                  # Статические файлы (CSS, JS, изображения)
│   ├── styles.css           # Основной CSS
│   ├── processed/           # Обработанные изображения
│   └── charts/              # Сгенерированные диаграммы для статистики
├── routes/                  # Эндпоинты
│   ├── index.py             # Модуль логики главной страницы
│   ├── clear_history.py     # Модуль логики очистки файлов
│   ├── result.py            # Модуль логики вывода результата
│   ├── upload.py            # Модуль логики обработки изображения
│   ├── search.py            # Модуль логики поиска изображения по метаданным
│   └── statistics.py        # Модуль логики формирования статистики по обработанным изображениям
├── core/                    # Логика обработки изображений
│   ├── detector.py          # Модуль детекции объектов
│   ├── ocr.py               # Модуль OCR (распознавание текста)
│   ├── spellcheck.py        # Модуль проверки орфографии
│   ├── translate.py         # Модуль перевода текста
│   ├── metadata.py          # Модуль работы с метаданными
│   └── metadata_export.py   # Модуль генерации XML-файлов
├── app.py                   # Основное Flask-приложение
├── requirements.txt         # Зависимости проекта
└── README.md                # Документация (этот файл)
```

***Описание API эндпоинтов***
```
GET /
Возвращает HTML главной страницы с историей обработанных изображений.

POST /upload
Принимает один или несколько файлов изображений (multipart/form-data), обрабатывает их (OCR, детекция объектов, коррекция, перевод) и возвращает страницу с результатами. Генерируется также XML-файл с метаданными.

GET /search
Принимает параметр запроса `q` и возвращает HTML-страницу с результатами поиска по обработанным данным.

POST /clear_history
Удаляет все JSON-файлы и обработанные изображения, затем перенаправляет на главную страницу.

GET /result/{id}
Возвращает HTML-страницу с подробным результатом обработки конкретного изображения. На этой странице доступна функция голосового озвучивания результата через Web Speech API.

GET /download_xml/{filename}
Позволяет скачать сгенерированный XML-файл с метаданными.

GET /stats
Отображает HTML-страницу со статистикой по обработанным изображениям, включая:
- Наиболее часто встречающееся слово (и его частоту);
- Наиболее часто встречающийся объект (и его частоту);
- Файл с наибольшим количеством исправлений текста;
- Интерактивные графики (Chart.js) для топ-10 слов и топ-10 объектов.

GET /export_stats_excel
Генерирует и отдает Excel-файл (формат .xlsx) со статистикой по обработке изображений, включая диаграммы (с использованием openpyxl и Matplotlib).
```

***Голосовое озвучивание***

На странице обработанного изображения (`result.html`) предусмотрена кнопка для озвучивания текста результата с использованием Web Speech API (встроенного в современные браузеры).

***Swagger документация***

Документация API доступна по адресу `/apidocs` благодаря Flasgger.

***Интерактивные графики***

На странице статистики используются интерактивные графики (Chart.js) для наглядного представления данных.